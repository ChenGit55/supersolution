{% extends 'base.html' %}
{% load static %}
{% block title %}{% endblock %}
{% block head %}
<style>
    th {
        padding-left: 15px;
    }
    td {
        padding-left: 15px;
        text-align: center;
    }
    #inovice {
        background-color: rgba(255, 228, 196, 0.5);
    }
</style>
{% endblock %}
{% block body %}
    <h1>Nova Venda</h1>
    <p>Vendedor: {{ user.username }}</p>
    <p>Loja: {{ user.store }}</p>

    <form action="." method="POST">{% csrf_token %}

        <select name="product-select" id="product-select">
            <option value="">---------</option>
            {% for choice in form.product.field.queryset %}
                <option value="{{ choice.id }}" data-price="{{ choice.price }}">{{ choice.title }}</option>
            {% endfor %}
        </select>
        {{ "R$"|safe }}<input class="price" style="width: 100px;"  type="text" id="product-price">
        Qtd: <input style="width: 60px;" type="number" id="product-quantity">

        <input type="button" id="add-product-button" value="Adicionar Produto">
    </form>
    <hr>
    <table>
        <thead>
            <tr>
                <th>PRODUTO</th>
                <th>PREÃ‡O</th>
                <th>QUANTIDADE</th>
                <th>TOTAL</th>
            </tr>
        </thead>
        <tbody id="inovice"></tbody>
    </table>
    <hr>
    <b>Valor Total: </b> <span id="inovice-total"></span>
    <div style="display: none;"  id="payment">
        <hr>
       <p><u><b>PAGAMENTO</b></u></p>
       <table>
        <thead>
            <tr>
                Forma de pagamento
            </tr>
            <tr>
                Valor
            </tr>
        </thead>
        <tbody id="payment-table"></tbody>
        <tbody id="total-payment"></tbody>
        <tbody id="payment-change"></tbody>
       </table>
    </div>
    <hr>


    <form action="." method="POST">{% csrf_token %}

        <input type="hidden" name="product_ids" id="product-ids">
        <input type="hidden" name="product_prices" id="product-prices">
        <input type="hidden" name="quantities" id="quantities">
        <input type="hidden" name="payments-data" id="payments-data">
        Forma de pagamento:
        <select name="payment-method" id="payment-method">
            {% for payment in payment_methods %}
                <option value="{{ payment.id }}">{{ payment }}</option>
            {% endfor %}
        </select>
        Valor Recebido : {{ "R$"|safe }}<input class="price" style="width: 100px;" type="text" id="payment-value">
        <input type="button" name="payment-confirmation" id="payment-confirmation" value="Confirmar" disabled>
        <hr>
        <input type="submit" name="close-inovice" id="close-inovice" value="Confirmar Venda" disabled>
    </form>


    <script src="{% static 'pos/js/pos.js' %}"></script>
    <script>
        $(document).ready(function () {
            $('.price').on('input', function () {
                var value = $(this).val();
                value = value.replace(/[^0-9]/g, '');
                value = value.replace(/^0+/, '');
                if (value.length > 2) {
                    value = value.slice(0, -2) + ',' + value.slice(-2);
                }
                $(this).val(value);
            });
        });
    </script>
{% endblock %}
{% block footer %}
{% endblock %}